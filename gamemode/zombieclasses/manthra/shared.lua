CLASS.Base = "zombie_legs"

CLASS.Name = "Manthra"
CLASS.TranslationName = "class_manthra"
CLASS.Description = "description_manthra"
CLASS.Help = "controls_manthra"
CLASS.Model = Model("models/player/catpants.mdl")
CLASS.OverrideModel = Model("models/player/catpants.mdl")
CLASS.Variations = false

CLASS.Weight = 0.77
CLASS.Boss = false 
CLASS.Hidden = true
CLASS.Wave = 200

CLASS.Pac3Out = {[1] = {
	["children"] = {
		[1] = {
			["children"] = {
			},
			["self"] = {
				["FollowAnglesOnly"] = false,
				["DrawOrder"] = 0,
				["InvertHideMesh"] = false,
				["TargetEntityUID"] = "",
				["AimPartName"] = "",
				["FollowPartUID"] = "",
				["Bone"] = "spine 2",
				["ScaleChildren"] = false,
				["UniqueID"] = "d15e9d54431488060441aaa7d1bfb4e0afbba8d271b4305256a3e57ca6a01955",
				["MoveChildrenToOrigin"] = false,
				["Position"] = Vector(42.30126953125, 0, -3.8028411865234),
				["AimPartUID"] = "",
				["Angles"] = Angle(0, 0, 0),
				["Hide"] = false,
				["Name"] = "",
				["Scale"] = Vector(2.5, 7.6999998092651, 5.5999999046326),
				["EditorExpand"] = false,
				["ClassName"] = "bone3",
				["Size"] = 1,
				["PositionOffset"] = Vector(0, 0, 0),
				["IsDisturbing"] = false,
				["AngleOffset"] = Angle(0, 0, 0),
				["EyeAngles"] = false,
				["HideMesh"] = false,
			},
		},
		[2] = {
			["children"] = {
			},
			["self"] = {
				["FollowAnglesOnly"] = false,
				["DrawOrder"] = 0,
				["InvertHideMesh"] = false,
				["TargetEntityUID"] = "",
				["AimPartName"] = "",
				["FollowPartUID"] = "",
				["Bone"] = "right calf",
				["ScaleChildren"] = false,
				["UniqueID"] = "7db3240386889617aa69babb2243e03e351d2d2678ce3a3b2139227e8148975e",
				["MoveChildrenToOrigin"] = false,
				["Position"] = Vector(-6.103515625e-05, -0.0001220703125, -19.2099609375),
				["AimPartUID"] = "",
				["Angles"] = Angle(0, 0, 0),
				["Hide"] = false,
				["Name"] = "",
				["Scale"] = Vector(1, 1, 1),
				["EditorExpand"] = false,
				["ClassName"] = "bone3",
				["Size"] = 1,
				["PositionOffset"] = Vector(0, 0, 0),
				["IsDisturbing"] = false,
				["AngleOffset"] = Angle(0, 0, 0),
				["EyeAngles"] = false,
				["HideMesh"] = false,
			},
		},
		[3] = {
			["children"] = {
			},
			["self"] = {
				["FollowAnglesOnly"] = false,
				["DrawOrder"] = 0,
				["InvertHideMesh"] = false,
				["TargetEntityUID"] = "",
				["AimPartName"] = "",
				["FollowPartUID"] = "",
				["Bone"] = "left calf",
				["ScaleChildren"] = false,
				["UniqueID"] = "88fdb62a945e612a762630d9f62a5313fb3da62cc67e2b71b8ff08828ead786c",
				["MoveChildrenToOrigin"] = false,
				["Position"] = Vector(6.103515625e-05, 0, 16.640377044678),
				["AimPartUID"] = "",
				["Angles"] = Angle(0, 0, 0),
				["Hide"] = false,
				["Name"] = "",
				["Scale"] = Vector(1, 1, 1),
				["EditorExpand"] = false,
				["ClassName"] = "bone3",
				["Size"] = 1,
				["PositionOffset"] = Vector(0, 0, 0),
				["IsDisturbing"] = false,
				["AngleOffset"] = Angle(0, 0, 0),
				["EyeAngles"] = false,
				["HideMesh"] = false,
			},
		},
		[4] = {
			["children"] = {
				[1] = {
					["children"] = {
					},
					["self"] = {
						["Skin"] = 0,
						["Invert"] = false,
						["LightBlend"] = 1,
						["CellShade"] = 0,
						["AimPartName"] = "",
						["IgnoreZ"] = false,
						["AimPartUID"] = "",
						["Passes"] = 1,
						["Name"] = "",
						["Angles"] = Angle(-0, -4.2688688495218e-07, -41.001117706299),
						["DoubleFace"] = false,
						["PositionOffset"] = Vector(0, -17.799999237061, 4.8000001907349),
						["BlurLength"] = 0,
						["OwnerEntity"] = false,
						["Brightness"] = 1,
						["DrawOrder"] = 0,
						["BlendMode"] = "",
						["TintColor"] = Vector(0, 0, 0),
						["Alpha"] = 1,
						["LodOverride"] = -1,
						["TargetEntityUID"] = "",
						["BlurSpacing"] = 0,
						["UsePlayerColor"] = false,
						["Material"] = "models/props_combine/com_shield001a",
						["UseWeaponColor"] = false,
						["EyeAngles"] = false,
						["UseLegacyScale"] = false,
						["Bone"] = "left hand",
						["Color"] = Vector(255, 255, 20),
						["Fullbright"] = false,
						["BoneMerge"] = false,
						["IsDisturbing"] = false,
						["Position"] = Vector(-12.082092285156, 48.934814453125, -32.503349304199),
						["NoTextureFiltering"] = false,
						["AlternativeScaling"] = false,
						["Hide"] = false,
						["Translucent"] = false,
						["Scale"] = Vector(1, 1, 1),
						["ClassName"] = "model",
						["EditorExpand"] = false,
						["Size"] = 0.05,
						["ModelFallback"] = "",
						["AngleOffset"] = Angle(90.5, 0, 14.199999809265),
						["TextureFilter"] = 3,
						["Model"] = "models/props_vehicles/trailer001a.mdl",
						["UniqueID"] = "5e3932ac5ffea5317e4d80d5ab764ef557a6ca50ed1d807fc3db2bc8a678c3bb",
					},
				},
			},
			["self"] = {
				["Skin"] = 0,
				["Invert"] = false,
				["LightBlend"] = 1,
				["CellShade"] = 0,
				["AimPartName"] = "",
				["IgnoreZ"] = false,
				["AimPartUID"] = "",
				["Passes"] = 1,
				["Name"] = "",
				["Angles"] = Angle(0, 0, 0),
				["DoubleFace"] = false,
				["PositionOffset"] = Vector(0, -31.10000038147, 0),
				["BlurLength"] = 0,
				["OwnerEntity"] = false,
				["Brightness"] = 1,
				["DrawOrder"] = 0,
				["BlendMode"] = "",
				["TintColor"] = Vector(0, 0, 0),
				["Alpha"] = 1,
				["LodOverride"] = -1,
				["TargetEntityUID"] = "",
				["BlurSpacing"] = 0,
				["UsePlayerColor"] = false,
				["Material"] = "",
				["UseWeaponColor"] = false,
				["EyeAngles"] = false,
				["UseLegacyScale"] = false,
				["Bone"] = "left hand",
				["Color"] = Vector(255, 255, 255),
				["Fullbright"] = false,
				["BoneMerge"] = false,
				["IsDisturbing"] = false,
				["Position"] = Vector(-8.2469997406006, 0.5093994140625, 17.170806884766),
				["NoTextureFiltering"] = false,
				["AlternativeScaling"] = false,
				["Hide"] = false,
				["Translucent"] = false,
				["Scale"] = Vector(1, 1, 1),
				["ClassName"] = "model",
				["EditorExpand"] = true,
				["Size"] = 0.05,
				["ModelFallback"] = "",
				["AngleOffset"] = Angle(0, 0, 0),
				["TextureFilter"] = 3,
				["Model"] = "models/props_vehicles/car001a_phy.mdl",
				["UniqueID"] = "9d6a3b05a2d74f4570edc7d860acfbae5d082bcb9791cfe6b28c2c19766a548f",
			},
		},
	},
	["self"] = {
		["DrawOrder"] = 0,
		["UniqueID"] = "9421ac80c1a1a5f04c5950ffb4f3f98e6fd5ea0dd7cf8247a3d1205bb926110b",
		["Hide"] = false,
		["TargetEntityUID"] = "",
		["EditorExpand"] = true,
		["OwnerName"] = "self",
		["IsDisturbing"] = false,
		["Name"] = "мой костюм",
		["Duplicate"] = false,
		["ClassName"] = "group",
	},
},
}

CLASS.KnockbackScale = 0
CLASS.BaraCat = false
CLASS.FearPerInstance = 1
CLASS.NoFallDamage = true
CLASS.NoFallSlowdown = true
CLASS.NoSlowdown = true

CLASS.Points = 2500

CLASS.SWEP = "weapon_zs_wand_of_manthra"

CLASS.Health = 108000
CLASS.Speed = 520
CLASS.JumpPower = 400


CLASS.ModelScale = 0.65
CLASS.Hull = {Vector(-16, -16, 0), Vector(16, 16, 32)}
CLASS.HullDuck = {Vector(-16, -16, 0), Vector(16, 16, 32)}
CLASS.ViewOffset = Vector(0, 0, 32 * CLASS.ModelScale)
CLASS.ViewOffsetDucked = Vector(0, 0, 32 * CLASS.ModelScale)
CLASS.StepSize = 25
CLASS.CrouchedWalkSpeed = 1
CLASS.Mass = DEFAULT_MASS * CLASS.ModelScale * 0.65

CLASS.NoCollideAll = true


CLASS.CanFeignDeath = false

CLASS.CantDuck = true

CLASS.SWEP = "weapon_zs_wand_of_manthra"

CLASS.BloodColor = -1

local math_random = math.random
local CurTime = CurTime

local ACT_RUN = ACT_RUN

function CLASS:PlayerStepSoundTime(pl, iType, bWalking)
	return GAMEMODE.BaseClass.PlayerStepSoundTime(GAMEMODE.BaseClass, pl, iType, bWalking) * self.ModelScale
end

function CLASS:ScalePlayerDamage(pl, hitgroup, dmginfo)
	if not dmginfo:IsBulletDamage() then return true end

	if hitgroup ~= HITGROUP_LEFTLEG and hitgroup ~= HITGROUP_RIGHTLEG and hitgroup ~= HITGROUP_GEAR and hitgroup ~= HITGROUP_GENERIC and dmginfo:GetDamagePosition().z > pl:LocalToWorld(Vector(0, 0, self.Hull[2].z * 1.33)).z then
		dmginfo:SetDamage(0)
		dmginfo:ScaleDamage(0)
	end

	return true
end

function CLASS:IgnoreLegDamage(pl, dmginfo)
	return true
end

local StepSounds = {
	"npc/zombie/foot1.wav",
	"npc/zombie/foot2.wav",
	"npc/zombie/foot3.wav"
}
function CLASS:PlayerFootstep(pl, vFootPos, iFoot, strSoundName, fVolume, pFilter)

	pl:EmitSound(StepSounds[math_random(#StepSounds)], 77, 50)

	if iFoot == 0 then
		pl:EmitSound("^npc/strider/strider_step4.wav", 90, math_random(95, 115))
	else
		pl:EmitSound("^npc/strider/strider_step5.wav", 90, math_random(95, 115))
	end

	return true
end

function CLASS:UpdateAnimation(pl, velocity, maxseqgroundspeed)
	local feign = pl.FeignDeath
	if feign and feign:IsValid() then
		if feign:GetState() == 1 then
			pl:SetCycle(1 - math.max(feign:GetStateEndTime() - CurTime(), 0) * 0.666)
		else
			pl:SetCycle(math.max(feign:GetStateEndTime() - CurTime(), 0) * 0.666)
		end
		pl:SetPlaybackRate(0)

		return true
	end

	local len2d = velocity:Length2D()
	if len2d > 1 then
		pl:SetPlaybackRate(math.min(len2d / maxseqgroundspeed * 0.75 / self.ModelScale, 3))
	else
		pl:SetPlaybackRate(1 / self.ModelScale)
	end

	return true
end
function CLASS:PrePlayerDraw(pl)
end

function CLASS:PostPlayerDraw(pl)
end
local messages = {" БЫЛА БЫ ТУТ МОЯ БРАТВА!", " БАРАБОГ,НАЧИНАЙ СВОЙ ХОД!", " ПОМНИТЕ БАРАКОТА НА КОЛЕСАХ?ЭТО Я СОЗДАЛ!"," ВЫ ХОРОШО РАЗВИЛИСЬ!", " ВАШИ ТЕХНОЛОГИИ МЕНЯ НЕ ПРОБЬЮТ!", " НЕТ СМЫСЛА ПЫТАТЬСЯ!"}
if SERVER then
	function CLASS:ProcessDamage(pl, dmginfo)
		dmginfo:ScaleDamage(0.33)
		if GAMEMODE.IdolsAreActive then
			dmginfo:SetDamage(0)
		end
		local attacker = dmginfo:GetAttacker() 
		if dmginfo:GetInflictor().Magic and dmginfo:GetAttacker() ~= pl then
			attacker:Kill()
			attacker:PrintMessage(HUD_PRINTTALK,'МАНХРА: ИСПОЛЬЗУЕШЬ МОЮ ЖЕ МАГИЮ ПРОТИВ МЕНЯ?ФАТАЛЬНАЯ ОШИБКА!')
		elseif dmginfo:GetInflictor():GetClass() == 'projectile_succubus_full' then
			attacker:PrintMessage(HUD_PRINTTALK,'МАНХРА: УСТАРЕВШАЯ ТЕХНОЛОГИЯ!МОЯ РАЗРАБОТКА БУДЕТ ЛУЧШЕ ЧЕМ ЭТО!')
			dmginfo:GetInflictor():Remove()
			pl:SetHealth(pl:Health()+6000)
		end
		if !pl.USEDHP_2 and pl:Health() < pl:GetMaxHealth() * 0.85 then
			pl.USEDHP_2 = true 
			PrintMessage(HUD_PRINTTALK,'МАНХРА: ДАВАЙТЕ! СНЕСИТЕ МОИ ИДОЛЫ!')
			gamemode.Call("CreateRandomObjectPos", "prop_idols", 7)
			timer.Simple(355, function() pl.USEDHP_2 = false end)
		end
		if math.random(1,300) == 1 then
			PrintMessage(HUD_PRINTTALK,'МАНХРА:'..messages[math.random(1,#messages)])
		end
		return dmginfo
	end

end